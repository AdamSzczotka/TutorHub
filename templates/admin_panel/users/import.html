{% extends "admin_panel/base.html" %}

{% block title %}{{ title }} - Na Piątkę{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">{{ title }}</h1>
        <a href="{% url 'accounts:user-list' %}" class="btn btn-ghost gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Powrót do listy
        </a>
    </div>

    <div class="grid gap-6">
        <!-- Instructions Card -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">Instrukcje</h2>
                <p>Prześlij plik CSV z użytkownikami do zaimportowania. Plik powinien zawierać następujące kolumny:</p>

                <div class="overflow-x-auto mt-4">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Kolumna</th>
                                <th>Wymagana</th>
                                <th>Opis</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for col in required_columns %}
                            <tr>
                                <td><code class="bg-base-200 px-2 py-1 rounded">{{ col }}</code></td>
                                <td><span class="badge badge-error">Tak</span></td>
                                <td>
                                    {% if col == 'email' %}Adres email użytkownika
                                    {% elif col == 'first_name' %}Imię
                                    {% elif col == 'last_name' %}Nazwisko
                                    {% elif col == 'role' %}Rola: student, tutor lub admin
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                            {% for col in optional_columns %}
                            <tr>
                                <td><code class="bg-base-200 px-2 py-1 rounded">{{ col }}</code></td>
                                <td><span class="badge badge-ghost">Nie</span></td>
                                <td>
                                    {% if col == 'phone' %}Numer telefonu (+48XXXXXXXXX)
                                    {% elif col == 'class_name' %}Klasa (dla uczniów)
                                    {% elif col == 'parent_name' %}Imię i nazwisko rodzica
                                    {% elif col == 'parent_email' %}Email rodzica
                                    {% elif col == 'parent_phone' %}Telefon rodzica
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-info mt-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Plik CSV powinien być w kodowaniu UTF-8 lub Windows-1250.</span>
                </div>
            </div>
        </div>

        <!-- Upload Form Card -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">Prześlij plik CSV</h2>

                <form method="post" enctype="multipart/form-data" id="import-form">
                    {% csrf_token %}

                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text">Wybierz plik CSV</span>
                        </label>
                        <input type="file"
                               name="csv_file"
                               accept=".csv"
                               class="file-input file-input-bordered w-full"
                               required>
                    </div>

                    <div class="form-control mt-4">
                        <label class="label cursor-pointer justify-start gap-2">
                            <input type="checkbox" name="send_emails" checked class="checkbox checkbox-primary">
                            <span class="label-text">Wyślij email powitalny z hasłem tymczasowym</span>
                        </label>
                    </div>

                    <div class="flex gap-2 mt-6">
                        <button type="submit"
                                name="validate_only"
                                value="1"
                                class="btn btn-outline"
                                hx-post="{% url 'accounts:user-import' %}"
                                hx-target="#import-preview"
                                hx-swap="innerHTML"
                                hx-encoding="multipart/form-data">
                            Sprawdź plik
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Importuj użytkowników
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Preview Container -->
        <div id="import-preview"></div>
    </div>
</div>
{% endblock %}
