<div class="space-y-4">
    <!-- Invoice Info -->
    <div class="bg-base-200 rounded-lg p-4">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium">Numer faktury:</span>
            <span class="font-mono">{{ invoice.invoice_number }}</span>
        </div>
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium">Kwota:</span>
            <span class="font-bold text-lg">{{ invoice.total_amount|floatformat:2 }} zl</span>
        </div>
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium">Termin platnosci:</span>
            <span>{{ invoice.due_date|date:"d.m.Y" }}</span>
        </div>
        <div class="flex items-center justify-between">
            <span class="text-sm font-medium">Status:</span>
            {% if invoice.status == 'PAID' %}
            <span class="badge badge-success">Oplacona</span>
            {% elif invoice.status == 'OVERDUE' %}
            <span class="badge badge-error">Zalegla</span>
            {% elif invoice.status == 'SENT' %}
            <span class="badge badge-info">Wyslana</span>
            {% else %}
            <span class="badge">{{ invoice.get_status_display }}</span>
            {% endif %}
        </div>
    </div>

    {% if invoice.status != 'PAID' %}
    <!-- Mark as Paid Form -->
    <form hx-post="{% url 'admin_invoices:mark_paid' invoice.id %}"
          hx-target="#payment-result"
          hx-swap="innerHTML"
          class="space-y-4">
        {% csrf_token %}

        <h3 class="font-semibold">Oznacz jako oplacona</h3>

        <div id="payment-result"></div>

        <div class="form-control">
            <label class="label">
                <span class="label-text">Data platnosci</span>
            </label>
            <input type="date"
                   name="paid_date"
                   class="input input-bordered w-full"
                   value="{{ 'now'|date:'Y-m-d' }}">
        </div>

        <button type="submit" class="btn btn-success w-full">
            <i data-lucide="check-circle" class="w-5 h-5"></i>
            Oznacz jako oplacone
        </button>
    </form>

    <div class="divider">lub</div>

    <!-- Create Credit Note -->
    <form hx-post="{% url 'admin_invoices:create_credit_note' invoice.id %}"
          hx-target="#credit-result"
          hx-swap="innerHTML"
          class="space-y-4">
        {% csrf_token %}

        <h3 class="font-semibold">Utworz note korygujaca</h3>

        <div id="credit-result"></div>

        <div class="form-control">
            <label class="label">
                <span class="label-text">Kwota korekty</span>
            </label>
            <input type="number"
                   step="0.01"
                   name="amount"
                   class="input input-bordered w-full"
                   placeholder="0.00"
                   max="{{ invoice.total_amount }}">
        </div>

        <div class="form-control">
            <label class="label">
                <span class="label-text">Powod korekty</span>
            </label>
            <textarea name="reason"
                      class="textarea textarea-bordered w-full"
                      rows="3"
                      placeholder="Opisz powod korekty..."></textarea>
        </div>

        <button type="submit" class="btn btn-outline w-full">
            <i data-lucide="file-minus" class="w-5 h-5"></i>
            Utworz note korygujaca
        </button>
    </form>
    {% else %}
    <div class="alert alert-success">
        <i data-lucide="check-circle" class="w-5 h-5"></i>
        <span>Faktura zostala oplacona {{ invoice.paid_date|date:"d.m.Y" }}</span>
    </div>
    {% endif %}
</div>
